@using SchoolCloudMVC.BO
@model BackendBO
@{
    ViewBag.Title = "Universidades_Administrador";
    Layout = "~/Views/Shared/MasterPageBE.cshtml";
}

<div class="right_col" role="main">
    <div class="">
        <div class="page-title">
            <div class="title_left">
           <h3>Universidades</h3>
            </div>
            <div class="title_right">
                <div class="col-md-5 col-sm-5 col-xs-12 form-group pull-right top_search">
                 
                    <div class="input-group">
                        <button class="btn btn-primary" title="Share this content" data-toggle="modal" data-target="#myModal">
                            <i class="fa fa-search"></i> Buscar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="clearfix"></div>
        <div class="row">
@using (Html.BeginForm("RegistrarUniversidad", "BackEnd", FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    @Html.AntiForgeryToken()
    @Html.HiddenFor(x=> x.IDUniversidad)
    @Html.HiddenFor(x => x.IDdireccion)
    @Html.HiddenFor(x => x.IDtel)
    @Html.HiddenFor(x => x.IDusuario)
            <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="x_panel">
                    <div class="x_title">
                        <h2>Catologo de Universidades<small>SchoolCloud</small></h2>
              
                        <div class="clearfix"></div>
                    </div>
                    <div class="x_content">
                        <div class="col-md-3 col-sm-3 col-xs-12 profile_left">
                            <div class="profile_img">
                                <div id="crop-avatar" style="width:100%;height:100%">
                                    <!-- Current avatar -->
                                    <img class="img-responsive avatar-view"  id="imgprw" src=""  >
                                  
                                </div>
                            </div>
                         @Html.HiddenFor(x => x.Fotouniversidad, new { @id = "Fotouniversidad" })
                            @*<h3 >Universidades </h3>*@
                            @*<ul class="list-unstyled user_data">
                                <li>
                                    <i class="fa fa-map-marker user-profile-icon"></i> San Francisco, California, USA
                                </li>
                                <li>
                                    <i class="fa fa-briefcase user-profile-icon"></i> Software Engineer
                                </li>
                                <li class="m-top-xs">
                                    <i class="fa fa-external-link user-profile-icon"></i>
                                    <a href="http://www.kimlabs.com/profile/" target="_blank">www.kimlabs.com</a>
                                </li>
                            </ul>*@
                            <h4>Cargar Fotografía</h4>
                            @Html.TextBoxFor(x => x.Fotouniversidad, new { @type = "File", @class = "btn btn-success form-group col-md-12 col-sm-12 col-xs-12", @onchange = "imagepreview(this)" })
                            @*<a class="btn btn-success"><i class="fa fa-edit m-right-xs"></i>Edit Profile</a>*@
                            <br />
                            <!-- start skills -->
                            

                            <!-- end of skills -->
                        </div>
                        <div class="col-md-9 col-sm-9 col-xs-12">

                            <div class="profile_title form-group">
                                <div class="col-md-6">
                                    <h2>Agregar universidad</h2>
                                </div>
                               
                            </div>
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="first-name">
                                Nombre de la Universidad<span class="required"></span>
                            </label>
                            <div class="form-group col-md-9 col-sm-9 col-xs-12">
                                @Html.TextBoxFor(x => x.Nombreuniversidad, new { @class = "form-control col-md-7 col-xs-12", @required = "required", @id = "Nombreuniversidad" })
                            </div>
                          
                            <!-- Formulario de Materias-Carreras-Universidades... -->

                            <!-- Formulario de Materias-Carreras-Universidades... -->

                               
                                <label class="control-label col-md-3 col-sm-3 col-xs-12" for="first-name">
                                    Tipo Universidad <span class="required"></span>
                                </label>
                                <div class="form-group col-md-9 col-sm-9 col-xs-12">
                                    <div id="TipoUniverisdad">

                                    </div>
                                </div>
                                <label class="control-label col-md-3 col-sm-3 col-xs-12" for="first-name">
                                   Descripción de la universidad<span class="required"></span>
                                </label>
                                <div class="form-group col-md-9 col-sm-9 col-xs-12">
                                    @Html.TextAreaFor(x => x.DescripcionUnivesidad, new { @id = "DescripcionUnivesidad", @maxlength = "700" , @class = "form-control col-md-7 col-xs-12", @required = "required" })
                                </div>
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="first-name">
                                    Teléfono<span class="required"></span>
                            </label>
                            <div class="form-group col-md-9 col-sm-9 col-xs-12">
                                @Html.TextBoxFor(x => x.Telefono, new { @id = "Telefono", @class = "form-control col-md-7 col-xs-12", @required = "required", @maxlength = "20" })
                            </div>
                                <div class="form-group">
                                    <div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">
                                        <input type="submit" id="gua" class="btn btn-success" value="Guardar" />
                                       
                                            <input type="submit" id="actu"  class="btn btn-primary" value="Actualizar" />
                                      
                                    </div>
                                </div>

                            



                            <!-- Tabla del Catlogo -->
                      
                            @*<div id="datatable_filter" class="dataTables_filter">
                                <label>
                                    Search:
                                    <input type="search" id="system-search" class="form-control input-sm" placeholder="Buscar" aria-controls="datatable">
                                </label>
                            </div>
                            <div class="x_content">
                                <p class="text-muted font-13 m-b-30">

                                </p>
                                <div id="TablaMaterias">

                                </div>
                            </div>*@
                        </div>
                         <div class="col-md-3 col-sm-3 col-xs-12">
                             </div>
                        <div class="col-md-9 col-sm-9 col-xs-12">
                            <div class="profile_title form-group">
                                <div class="col-md-6">
                                    <h2>Dirección de la Universidad</h2>
                                </div>
                                <div class="col-md-3">
                                    </div>
                                <div class="col-md-3">
                                    <input type="submit" id="AgregarDireccion" class="btn btn-success" value="Agregar otra Dirección" />
                                </div>
                                   
                                </div>
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="first-name">
                                Dirección de la Univeridad<span class="required"></span>
                            </label>
                            <div class="form-group col-md-9 col-sm-9 col-xs-12">
                                @Html.TextBoxFor(x => x.Direccion, new { @class = "form-control col-md-7 col-xs-12", @required = "required" })
                            </div>
                            <label class="control-label col-md-3 col-sm-3 col-xs-12" for="first-name">
                                Especificar la Ubicación<span class="required"></span>
                            </label>
                            <div class="form-group col-md-9 col-sm-9 col-xs-12">
                               <input type="text" class="form-control col-md-7 col-xs-12" id="ubicacion" required="required" text="Mérida Yucatán" />
                            </div>
                            <div class="form-group">
                                <div id="TablaMapa" style="width:100%;height:300px;">
                                </div>
                            </div>
                         
                            <div class="form-group col-md-9 col-sm-9 col-xs-12">
                                @Html.HiddenFor(x => x.Latituf, new { @class = "form-control col-md-7 col-xs-12", @required = "required" })
                            </div>
                     
                            <div class="form-group col-md-9 col-sm-9 col-xs-12">
                                @Html.HiddenFor(x => x.Longitud, new { @class = "form-control col-md-7 col-xs-12", @required = "required" })
                            </div>
                            
                        </div>
                        @*<div id="datatable_filter" class="dataTables_filter">
                            <label>
                                Search:
                                <input type="search" id="system-search" class="form-control input-sm" placeholder="Buscar" aria-controls="datatable">
                            </label>
                        </div>
                        <div class="x_content">
                            <p class="text-muted font-13 m-b-30">

                            </p>
                            <div id="TablaUniversidades">

                            </div>
                        </div>*@

                        </div>
                </div>
            </div>
        
}
         
        </div>
        
    </div>
</div>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg ">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="myModalLabel"><i class="fa fa-search"></i> Buscar Universidades</h4>
            </div>
            <div class="modal-body">
       

              
                <div id="datatable_filter" class="dataTables_filter">
                    <label>
                        Buscar:
                        <input type="search" id="system-search" class="form-control input-sm" placeholder="Buscar" aria-controls="datatable">
                    </label>
                </div>
            <div id="TablaUniversidades">

            </div>
      
          
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>
<style>
    .modal-body {
   height: 400px;
    overflow-y: auto;
}

</style>
<script type="text/javascript">
    (function () {//Función anónima autoejecutable
        document.getElementById('AgregarDireccion').style.visibility = 'hidden';



             $("#TipoUniverisdad").load('/VistasParciales/_TipoUniversidad');
             $("#TablaUniversidades").load('/VistasParciales/_TablaUniversidades');
             $('#Latituf').val(21.0307721);
             $('#Longitud').val(-89.64634519999998)
         }());
      
         document.getElementById("imgprw").src = "/Picture/ImagenesUsuario/default.png";
         //YEAH BABY
    
         //var contenedor = document.getElementById("imgprw");
         //contenedor.innerHTML = "< scr= '~/Picture/ImagenesUsuario/default.png' />"
         ////     var xx = parent.location.href;
         //var xx = xx.toUpperCase();
         //if (xx.indexOf('Universidades_Administrador') != -1) {
         //    contenedor.src = "~/Picture/ImagenesUsuario/default.png"
         //} else {
         //    contenedor.src = "~/Picture/ImagenesUsuario/default.png"
         //}


         $('#btnguardar').click(function () {

             var url = "@Url.Action("RegistrarUniversidad", "BackEnd")";

             var municipio = $("#municipio").val();
             var idestado = $("#idestado").val();
             var data = { municipio: municipio, idestado: idestado };

             $.post(url, data).done(function (data) {

                 $("#listamun").load('/AlumAjax/Listamun');

             });
         }
         );
</script>
<script>
    $('#TablaMapa').locationpicker({
            radius: 0,
            location: {
                latitude: $('#Latituf').val(),
                longitude: $('#Longitud').val(),
            },
            inputBinding: {
                latitudeInput: $('#Latituf'),
                longitudeInput: $('#Longitud'),
                locationNameInput: $('#ubicacion')


            },
            enableAutocomplete:true

        })


</script>
<script type="text/javascript">
                function imagepreview(input) {
                    var fildr = new FileReader();
                    fildr.onload = function (e) {
                        $('#imgprw').attr('src', e.target.result);
                    }
                    fildr.readAsDataURL(input.files[0]);
                }

                document.getElementById("actu").disabled = true;
</script>

<script>
        $(document).ready(function () {
            var activeSystemClass = $('.list-group-item.active');

            //something is entered in search form
            $('#system-search').keyup(function () {
                var that = this;
                // affect all table rows on in systems table
                var tableBody = $('.table-striped tbody');
                var tableRowsClass = $('.table-striped tbody tr');
                $('.search-sf').remove();
                tableRowsClass.each(function (i, val) {

                    //Lower text for case insensitive
                    var rowText = $(val).text().toLowerCase();
                    var inputText = $(that).val().toLowerCase();
                    if (inputText != '') {
                        $('.search-query-sf').remove();
                        tableBody.prepend('<tr class="search-query-sf"><td colspan="6"><strong>Buscando Universidad: "'
                            + $(that).val()
                            + '"</strong></td></tr>');
                    }
                    else {
                        $('.search-query-sf').remove();
                    }

                    if (rowText.indexOf(inputText) == -1) {
                        //hide rows
                        tableRowsClass.eq(i).hide();

                    }
                    else {
                        $('.search-sf').remove();
                        tableRowsClass.eq(i).show();
                    }
                });
                //all tr elements are hidden
                if (tableRowsClass.children(':visible').length == 0) {
                    tableBody.append('<tr class="search-sf"><td class="text-muted" colspan="6">No entries found.</td></tr>');
                }
            });
        });
</script> 
<script>

    ////cambiar imagen de perfil
    $(document).ready(function () {
        $("#frmcambiarfoto").submit(function (e) {
            e.preventDefault();
            var form = $('#frmcambiarfoto')[0];
            var dataString = new FormData(form);
            $.ajax({
                url: '/Ajax/Ajax?data=guardarfotos',  //Server script to process data
                type: 'POST',
                data: dataString,
                //Options to tell jQuery not to process data or worry about content-type.
                cache: false,
                contentType: false,
                processData: false,

                beforeSend: function () {

                    $("#btnupdatepicture").html('<li class="fa fa-spinner fa-spin"></li>Actualizando');
                    $("#btnupdatepicture").prop('disabled', true);
                    $("#sss").show();
                    $("#uploadimg").hide();

                },
                success: function (a) {
                    if (a == 1) {
                        swal({
                            text: 'Se ha actualizado tu foto de perfil!',
                            type: "success",
                            confirmButtonText: "Aceptar",
                            confirmButtonColor: "#7986CB",
                            closeOnCancel: true,
                            closeOnConfirm: true,
                            showLoaderOnConfirm: true
                        })
                        myinfo();
                        $("#btnupdatepicture").html('Actualizar');
                        $("#btnupdatepicture").prop('disabled', true);
                        $("#uploadimg").hide();
                        $("#btncancelarfoto").hide();
                        $("#uploadimg").hide();
                        $("#sss").hide();

                    }

                }
            });
        });
    });
</script>